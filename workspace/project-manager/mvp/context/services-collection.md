# ðŸ“š Collection of Application Services (MVVM)

> This document contains a collection of internal, single-responsibility services for the SuperMarty application's MVVM architecture. These services encapsulate specific business logic or infrastructure concerns and are designed to be injected into ViewModels.

**Purpose of this Collection:** To define the clear separation of concerns within the application, promote testability, and provide a high-level architectural overview of the client-side logic.

---

## Collection Items

| Service Name                 | Category         | Description / Responsibilities                                                                                                                                                                                                                                                                |
|:-----------------------------|:-----------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **`SupabaseService`**        | Data & Network   | Initializes and configures the connection to the Supabase backend. Provides a singleton `SupabaseClient` instance that other services (like `ProductService`, `AuthService`) will use to interact with the database, authentication, and storage. It abstracts away the initialization logic. |
| **`AuthService`**            | User & Identity  | Manages user authentication state. Provides methods like `login()`, `signUp()`, `logout()`, `getCurrentUser()`. Uses the `SupabaseService` to interact with Supabase Auth. Stores and retrieves session tokens.                                                                               |
| **`LocalStorageService`**    | Device & Storage | Provides a simple key-value store interface for persisting data on the device (e.g., using `shared_preferences` in Flutter). Used for caching settings, session tokens, etc.                                                                                                                  |
| **`ThemeService`**           | UI & State       | Manages the application's visual theme (e.g., light mode, dark mode, system default). Persists the user's choice using `LocalStorageService`.                                                                                                                                                 |
| **`NavigationService`**      | UI & Navigation  | Abstracts navigation logic (pushing/popping screens). Allows ViewModels to request navigation without having a direct dependency on the UI framework's routing mechanism.                                                                                                                     |
| **`ProductService`**         | Business Logic   | Central point for all product-related data operations. Fetches products, categories, and performs searches. Uses `SupabaseService` to get data from the backend.                                                                                                                              |
| **`ShoppingBagService`**     | Business Logic   | **This is the critical service for the user's shopping journey.** It handles all logic for the user's personal, dynamic shopping bag: creating the bag, adding/removing products selected by the user, updating quantities, and preparing the bag's contents for the final checkout and price comparison. |
| **`RecipeService`**          | Business Logic   | Responsible for fetching and managing recipes and their ingredients. Uses `SupabaseService`.                                                                                                                                                                                                  |
| **`MealPlanService`**        | Business Logic   | Responsible for fetching and managing meal plans and their associated recipes. Uses `SupabaseService`.                                                                                                                                                                                        |
| **`CuratedBagService`**      | Business Logic   | Responsible for fetching and managing admin-created, pre-defined shopping bags (e.g., "Weekly Essentials"). Differentiated from the user's dynamic ShoppingBag. Uses `SupabaseService`.                                                                                                       |
| **`UserProfileService`**     | Business Logic   | Manages user profile data such as first name, last name, and avatar URL. Responsible for fetching and updating this non-sensitive user information. Uses `SupabaseService`.                                                                                                                     |
| **`FavoriteService`**        | Business Logic   | Manages user favorites. Handles adding/removing products, recipes, and meal plans to a user's list of favorites. Uses `SupabaseService`.                                                                                                                                                       |
| **`HealthProfileService`**   | Business Logic   | Manages all aspects of the user's health profile. Handles GDPR consent, and securely fetches/updates sensitive data like allergies and dietary goals. Uses `SupabaseService`.                                                                                                                 |
| **`PriceComparisonService`** | Business Logic   | Responsible for the logic of comparing a shopping bag across different supermarkets. Takes a list of `ShadowProduct`s and returns a comparison result.                                                                                                                                        |
| **`CheckoutService`**        | Business Logic   | **Handles the final checkout logic.** Orchestrates the checkout flow by using the `ShoppingBagService` to get the final cart, the `PriceComparisonService` to get costs, and then manages the redirection to the chosen supermarket's platform for the user to complete the payment. |
| **`AIAssistantService`**     | Business Logic   | Handles all interactions with the "Super Marty" AI assistant. Manages the chat state and communicates with the LLM backend endpoint via the `SupabaseService`.                                                                                                                                |
| **`LoggerService`**          | Utilities        | A centralized service for logging application events, errors, and debug information to the console or a third-party logging service (e.g., Sentry, Firebase Crashlytics).                                                                                                                     |
| **`AnalyticsService`**       | Utilities        | Tracks user interaction events (e.g., button clicks, screen views) and sends them to an analytics platform.                                                                                                                                                                                   |
| **`NotificationService`**    | Device & System  | Manages push notifications and in-app messaging. Handles token registration and message display.                                                                                                                                                                                              |

---

### Notes

*   **Dependency Injection:** These services are designed to be managed by a dependency injection (DI) framework (like `get_it` or `provider` in Flutter). ViewModels will declare their dependencies, and the DI container will provide the appropriate service instance.
*   **Interfaces/Abstract Classes:** In a production app, each service would typically have an abstract class (interface) defining its contract, with a concrete implementation. This allows for easy swapping and testing. For example, `IAuthService` and its implementation `AuthServiceImpl`.
*   **State Management:** Services like `AuthService` and `ShoppingBagService` will often manage their own state and expose it via Streams, Notifiers, or other reactive patterns for the UI to consume.
